<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartTask FAQ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 800px; margin: 40px auto; padding: 0 20px; }
        h1 { color: #2c3e50; }
        input, button { padding: 12px; font-size: 16px; margin: 10px 0; }
        input { width: 70%; }
        button { background: #3498db; color: white; border: none; cursor: pointer; }
        button:hover { background: #2980b9; }
        #result { margin-top: 20px; padding: 15px; border-left: 4px solid #3498db; background: #f8f9fa; }
        .sources { margin-top: 10px; }
        .meta { font-size: 0.85em; color: #7f8c8d; }
    </style>
</head>
<body>
    <h1>üí¨ –£–º–Ω—ã–π FAQ –¥–ª—è SmartTask</h1>
    <p>–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞.</p>

    <input type="text" id="question" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: SmartTask ‚Äî —ç—Ç–æ?" autofocus>
    <button onclick="ask()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

    <div id="result" style="display:none;"></div>

    <script>
        async function ask() {
            const input = document.getElementById("question");
            const question = input.value.trim();
            if (!question) return;

            const resultDiv = document.getElementById("result");
            resultDiv.style.display = "block";
            resultDiv.innerHTML = "<em>–î—É–º–∞—é...</em>";

            try {
                const res = await fetch("/api/v1/ask", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.detail || "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
                }

                const sourcesHtml = data.sources.length
                    ? `<h4>üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏:</h4><ul>${data.sources.map(s => `<li>${s}</li>`).join('')}</ul>`
                    : "";

                resultDiv.innerHTML = `
                    <h3>–û—Ç–≤–µ—Ç:</h3>
                    <p>${data.answer.replace(/\n/g, '<br>')}</p>
                    ${sourcesHtml}
                    <div class="meta">
                        ‚è±Ô∏è ${data.response_time_ms} –º—Å |
                        üìè in: ${data.tokens.input}, out: ${data.tokens.output} —Ç–æ–∫–µ–Ω–æ–≤
                    </div>
                `;
            } catch (e) {
                resultDiv.innerHTML = `<p style="color:red">‚ùå ${e.message}</p>`;
            }
        }

        // Enter ‚Üí submit
        document.getElementById("question").addEventListener("keypress", function(e) {
            if (e.key === "Enter") ask();
        });
    </script>
</body>
</html>